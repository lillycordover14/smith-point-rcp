<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Smith Point — Connection Finder</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{--s950:#020617;--s900:#0f172a;--s800:#1e293b;--s700:#334155;--s500:#64748b;--s400:#94a3b8;--s300:#cbd5e1;--s200:#e2e8f0;--s100:#f1f5f9;--s50:#f8fafc;--grn:#22c55e;--amb:#f59e0b;--rose:#f43f5e;--blu:#3b82f6;--vio:#8b5cf6;--f:'Instrument Sans',system-ui,sans-serif;--m:'JetBrains Mono',monospace}
    html,body,#root{height:100%}
    body{background:var(--s50);font-family:var(--f);-webkit-font-smoothing:antialiased;color:var(--s900)}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
    input,button,textarea{font-family:var(--f)}
    button{cursor:pointer}
    .chip{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;border:1.5px solid var(--s200);background:#fff;cursor:pointer;transition:all .12s;user-select:none}
    .chip:hover{border-color:var(--s400);transform:translateY(-1px)}
    .chip.on{background:var(--s900);color:#fff;border-color:var(--s900)}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel" data-presets="react">
const{useState,useRef}=React;

// Backend URL — change if running elsewhere
const API = window.location.origin;

/* ═══ SP TEAM (22 people) ═══ */
const SP=[
  {id:"kb",n:"Keith Block",t:"Founder & CEO",ty:"core",li:"https://www.linkedin.com/in/keith-block-516a1811/",
   edu:[{s:"Carnegie Mellon University",y:[1980,1984]}],
   orgs:["Oracle","Salesforce","Booz Allen Hamilton"],
   board:["Salesforce","Carnegie Mellon University","World Economic Forum","Business Roundtable"],
   loc:"San Francisco, CA",
   det:[{c:"Salesforce",r:"Co-CEO / President / COO / Board",s:2013,e:2020},{c:"Oracle",r:"EVP North America (~26 yrs)",s:1986,e:2012},{c:"Booz Allen Hamilton",r:"Consultant"}]},
  {id:"bn",n:"Burke Norton",t:"Co-founder & MD",ty:"core",li:"https://www.linkedin.com/in/burke-norton-121a1a2/",
   edu:[{s:"UC Berkeley School of Law",y:[1989,1993]}],
   orgs:["Wilson Sonsini Goodrich & Rosati","Expedia","Salesforce","Vista Equity Partners"],
   board:["Business Software Alliance","World Economic Forum","Council on Foreign Relations"],loc:"San Francisco, CA",
   det:[{c:"Vista Equity Partners",r:"Senior MD",s:2017,e:2022},{c:"Salesforce",r:"CLO",s:2011,e:2017},{c:"Expedia",r:"EVP, GC",s:2006,e:2011},{c:"Wilson Sonsini Goodrich & Rosati",r:"Partner",s:1995,e:2006}]},
  {id:"cl",n:"Christopher Lytle",t:"Co-founder & MD",ty:"core",li:"https://www.linkedin.com/in/chris-lytle-a8141a15/",
   edu:[{s:"Lafayette College",y:[1987,1991]}],
   orgs:["Longfellow Capital","Inseego","Cavulus","Morgan Stanley","Osterweis Capital Management"],
   board:["Inseego","Prolifiq","Virtualitics","ZEDEDA"],loc:"Old Greenwich, CT",
   det:[{c:"Longfellow Capital",r:"President",s:2009,e:2022},{c:"Inseego",r:"EVP & CSO",s:2017,e:2018},{c:"Morgan Stanley",r:"MD",s:2006,e:2009},{c:"Morgan Stanley",r:"Equity Research",s:1991,e:1998}]},
  {id:"jc",n:"John Cummings",t:"MD, CFO/COO",ty:"core",li:"https://www.linkedin.com/in/johncummings/",
   edu:[{s:"Columbia Business School",y:[1992,1994]},{s:"UC Berkeley Haas School of Business",y:[1992,1994]},{s:"UCLA",y:null}],
   orgs:["Salesforce","Celonis"],board:[],loc:"San Francisco, CA",
   det:[{c:"Celonis",r:"SVP Finance",s:2020,e:2024},{c:"Salesforce",r:"SVP Finance",s:2011,e:2020}]},
  {id:"tp",n:"Tyler Prince",t:"MD, Head of Value Creation",ty:"core",li:"https://www.linkedin.com/in/tyler-prince-210701/",
   edu:[{s:"University of Illinois Urbana-Champaign",y:[1993,1997]}],
   orgs:["Snowflake","Salesforce","Oracle","PwC","PeopleSoft","IBM","Andersen Consulting"],
   board:["American Cancer Society"],loc:"Chicago, IL",
   det:[{c:"Snowflake",r:"SVP Alliances",s:2023,e:2025},{c:"Salesforce",r:"EVP"},{c:"PwC",r:"Partner"},{c:"Oracle",r:"Mgmt"},{c:"PeopleSoft",r:"Mgmt"},{c:"IBM",r:"Mgmt"}]},
  {id:"cn",n:"Christian Nysaether",t:"Operating Principal",ty:"core",li:"https://www.linkedin.com/in/christian-nysaether-1242338",
   edu:[],orgs:["Salesforce","Snowflake"],board:[],loc:"San Francisco, CA",
   det:[{c:"Salesforce",r:"Sr Dir GTM Strategy"},{c:"Snowflake",r:"Sr Dir Partner Strategy"}]},
  {id:"bks",n:"Brooke Kiley Slattery",t:"Principal Investor",ty:"core",li:"https://www.linkedin.com/in/brooke-kiley-slattery-7372949a/",
   edu:[{s:"University of Pennsylvania - Wharton",y:[2008,2012]}],
   orgs:["VMG Partners","Insight Partners"],board:["Ampla","Good Face Project","Daasity"],loc:"New York, NY",
   det:[{c:"VMG Partners",r:"Founding Partner",s:2020,e:2024},{c:"Insight Partners",r:"Investor"}]},
  {id:"ls",n:"Lorenzo Salazar",t:"Principal Investor",ty:"core",li:"https://www.linkedin.com/in/lorenzosalazar16/",
   edu:[{s:"University of Texas at Austin McCombs",y:[2014,2016]}],
   orgs:["Ionic Partners","Vista Equity Partners","Credit Suisse"],board:[],loc:"Austin, TX",
   det:[{c:"Ionic Partners",r:"Investor"},{c:"Vista Equity Partners",r:"Investor"},{c:"Credit Suisse",r:"Banking"}]},
  {id:"sp2",n:"Sewon Park",t:"Associate",ty:"core",li:"https://www.linkedin.com/in/sewon-park-a939b9156/",
   edu:[],orgs:[],board:[],loc:"New York, NY",det:[]},
  {id:"lc",n:"Lily Cordover",t:"Analyst",ty:"core",li:"https://www.linkedin.com/in/lillycordover/",
   edu:[{s:"University of Virginia McIntire",y:[2019,2023]}],
   orgs:["Fifth Wall"],board:[],loc:"New York, NY",det:[{c:"Fifth Wall",r:"Analyst",s:2023,e:2024}]},
  {id:"kr",n:"Katie Rodday",t:"Dir of Operations",ty:"core",li:"https://www.linkedin.com/in/katie-rodday-082071a/",
   edu:[{s:"Stonehill College",y:[2004,2008]}],orgs:[],board:[],loc:"Boston, MA",det:[]},
  {id:"ko",n:"Kari Owens",t:"EA",ty:"core",li:"",edu:[],orgs:[],board:[],loc:"",det:[]},
  {id:"po",n:"Paige O'Connor",t:"EA",ty:"core",li:"",edu:[],orgs:[],board:[],loc:"",det:[]},
  // PAN
  {id:"ak",n:"Andy Kofoid",t:"President, Databricks",ty:"pan",li:"https://www.linkedin.com/in/andy-kofoid-9377a91/",
   edu:[],orgs:["Databricks","Salesforce","ExactTarget"],board:[],loc:"",det:[{c:"Databricks",r:"President"},{c:"Salesforce",r:"Exec"},{c:"ExactTarget",r:"Exec"}]},
  {id:"mm",n:"Maria Martinez",t:"Customer Success",ty:"pan",li:"https://www.linkedin.com/in/martinezmaria/",
   edu:[],orgs:["Cisco","Salesforce","Microsoft"],board:[],loc:"",det:[{c:"Cisco",r:"Exec"},{c:"Salesforce",r:"Exec"},{c:"Microsoft",r:"Exec"}]},
  {id:"sv",n:"Sara Varni",t:"CMO, Datadog",ty:"pan",li:"https://www.linkedin.com/in/saravarnibright/",
   edu:[],orgs:["Datadog","Twilio","Salesforce"],board:[],loc:"",det:[{c:"Datadog",r:"CMO"},{c:"Twilio",r:"CMO"},{c:"Salesforce",r:"Mktg"}]},
  {id:"js2",n:"Jeff Sanders",t:"Heidrick & Struggles",ty:"pan",li:"https://www.linkedin.com/in/jeffsanders2/",
   edu:[],orgs:["Heidrick & Struggles"],board:[],loc:"",det:[{c:"Heidrick & Struggles",r:"Global CEO & Board Practice"}]},
  {id:"jw",n:"John Wookey",t:"Product",ty:"pan",li:"https://www.linkedin.com/in/john-wookey/",
   edu:[],orgs:["SAP","Salesforce","Oracle"],board:[],loc:"",det:[{c:"SAP",r:"Product"},{c:"Salesforce",r:"Product"},{c:"Oracle",r:"Product"}]},
  {id:"le",n:"Lisa Edwards",t:"Operations",ty:"pan",li:"https://www.linkedin.com/in/lisaedwardssf/",
   edu:[],orgs:["Diligent","Salesforce"],board:["Visa","ZEDEDA"],loc:"",det:[{c:"Diligent",r:"President & COO"},{c:"Salesforce",r:"Exec"}]},
  {id:"ps",n:"Paul Smith",t:"CCO, Anthropic",ty:"pan",li:"https://www.linkedin.com/in/pjsmith/",
   edu:[],orgs:["Anthropic","ServiceNow","Salesforce","Microsoft","Procter & Gamble","Umee"],board:[],loc:"",
   det:[{c:"Anthropic",r:"CCO"},{c:"ServiceNow",r:"Exec"},{c:"Salesforce",r:"Exec"},{c:"Microsoft",r:"Exec"}]},
  {id:"lsh",n:"Larry Shurtz",t:"CSO, Genesys",ty:"pan",li:"https://www.linkedin.com/in/larryshurtz/",
   edu:[],orgs:["Genesys","Confluent","Salesforce","Oracle"],board:[],loc:"",det:[{c:"Genesys",r:"CSO"},{c:"Confluent",r:"Sales"},{c:"Salesforce",r:"Sales"},{c:"Oracle",r:"Sales"}]},
  {id:"as",n:"Ari Schmorak",t:"GTM, Stripe",ty:"pan",li:"https://www.linkedin.com/in/ari-schmorak-8a073b1/",
   edu:[],orgs:["Stripe","Salesforce","McKinsey & Company"],board:[],loc:"",det:[{c:"Stripe",r:"Head GTM"},{c:"Salesforce",r:"Exec"},{c:"McKinsey & Company",r:"Consultant"}]},
];

const SP_ORGS=[...new Set(SP.flatMap(m=>[...m.orgs,...(m.det||[]).map(d=>d.c)]).filter(Boolean))].filter(o=>o!=="Smith Point Capital").sort();
const SP_SCHOOLS=[...new Set(SP.flatMap(m=>(m.edu||[]).map(e=>e.s)).filter(Boolean))].sort();

/* ═══ SCORING ═══ */
function sN(n){return n.toLowerCase().replace(/university|college|the\s|of\s|school|-/g,"").trim();}
function yO(a,b){return a&&b&&a[0]&&a[1]&&b[0]&&b[1]&&a[0]<=b[1]&&b[0]<=a[1];}
function oE(a,b){return a.trim().toLowerCase()===b.trim().toLowerCase();}

function score1(sp,tgt){
  const sig=[];const m=new Set();
  for(const so of(sp.orgs||[]))for(const to of(tgt.orgs||[]))
    if(oE(so,to)&&!m.has(so.toLowerCase())){m.add(so.toLowerCase());sig.push({type:"company",label:"Both at "+so,detail:sp.n+" & "+tgt.name+" both worked at "+so,pts:30,icon:"\u{1F3E2}"});}
  for(const d of(sp.det||[]))for(const to of(tgt.orgs||[]))
    if(oE(d.c,to)&&!m.has(d.c.toLowerCase())&&d.c.toLowerCase()!=="smith point capital"){m.add(d.c.toLowerCase());sig.push({type:"company",label:"Both at "+d.c,detail:sp.n+" ("+d.r+") & "+tgt.name+" — "+d.c,pts:25,icon:"\u{1F3E2}"});}
  for(const se of(sp.edu||[]))for(const te of(tgt.education||[]))
    if(sN(se.s)===sN(te.s||"")){const ov=yO(se.y,te.y);sig.push({type:"education",label:ov?"Overlapped at "+se.s:"Both attended "+se.s,detail:sp.n+" & "+tgt.name+(ov?" overlapped at ":" both attended ")+se.s,pts:ov?20:12,icon:"\u{1F393}"});}
  for(const sb of(sp.board||[]))for(const tb of(tgt.board||[]))
    if(oE(sb,tb))sig.push({type:"board",label:"Board: "+sb,detail:"Both on "+sb+" board",pts:20,icon:"\u{1FA91}"});
  if(sp.loc&&tgt.location&&sp.loc.split(",")[0].trim().toLowerCase()===tgt.location.split(",")[0].trim().toLowerCase())
    sig.push({type:"location",label:"Same city: "+sp.loc.split(",")[0],detail:"Both in "+sp.loc,pts:5,icon:"\u{1F4CD}"});
  const sc=Math.min(100,sig.reduce((a,s)=>a+s.pts,0));
  return{sig,sc,str:sc>=40?"strong":sc>=20?"medium":"weak"};
}

function scoreAll(people){
  const out=[];
  for(const p of people)for(const sp of SP){const{sig,sc,str}=score1(sp,p);if(sig.length)out.push({sp,tgt:p,sig,sc,str});}
  return out.sort((a,b)=>b.sc-a.sc);
}

function mkI(name){return(name||"?").split(" ").filter(Boolean).map(w=>w[0]).join("").slice(0,2).toUpperCase();}

/* ═══ DESIGN ═══ */
const STR={strong:{c:"#22c55e",bg:"rgba(34,197,94,.08)",l:"Strong"},medium:{c:"#f59e0b",bg:"rgba(245,158,11,.08)",l:"Medium"},weak:{c:"#94a3b8",bg:"rgba(148,163,184,.08)",l:"Weak"}};
const TCOL={company:"#3b82f6",education:"#8b5cf6",board:"#ec4899",location:"#10b981"};

/* ═══ COMPONENTS ═══ */
function Av({i,sz=36,on=false,pan=false}){return<div style={{width:sz,height:sz,borderRadius:"50%",flexShrink:0,background:on?(pan?"#312e81":"var(--s900)"):"var(--s100)",border:on?(pan?"2px solid var(--vio)":"2px solid var(--blu)"):"1.5px solid var(--s200)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:sz*.3,fontWeight:700,color:on?"#fff":"var(--s500)",letterSpacing:"-.5px"}}>{i}</div>;}
function Bdg({s}){const c=STR[s]||STR.weak;return<span style={{display:"inline-flex",alignItems:"center",gap:4,padding:"2px 8px",borderRadius:12,fontSize:10,fontWeight:700,background:c.bg,color:c.c}}><span style={{width:5,height:5,borderRadius:"50%",background:c.c}}/>{c.l}</span>;}
function Rng({sc,sz=44}){const r=(sz-5)/2,ci=2*Math.PI*r,fi=(sc/100)*ci,co=sc>=40?"var(--grn)":sc>=20?"var(--amb)":"var(--s400)";return<div style={{position:"relative",width:sz,height:sz,flexShrink:0}}><svg width={sz} height={sz} style={{transform:"rotate(-90deg)"}}><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke="var(--s100)" strokeWidth={3.5}/><circle cx={sz/2} cy={sz/2} r={r} fill="none" stroke={co} strokeWidth={3.5} strokeDasharray={fi+" "+(ci-fi)} strokeLinecap="round"/></svg><div style={{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:800}}>{sc}</div></div>;}
function PLink({p}){const[h,setH]=useState(false);if(!p)return null;const nm=<span style={{fontSize:13,fontWeight:700,color:h&&p.linkedin?"var(--blu)":"var(--s900)",transition:"color .1s"}}>{p.name||p.n}{p.linkedin&&<span style={{fontSize:9,marginLeft:3,opacity:h?1:.3}}>{"\u2197"}</span>}</span>;return p.linkedin?<a href={p.linkedin} target="_blank" rel="noopener noreferrer" style={{textDecoration:"none"}} onMouseEnter={()=>setH(true)} onMouseLeave={()=>setH(false)}>{nm}</a>:<span>{nm}</span>;}

function OCard({o}){
  const{sp:s,tgt:t,sig,sc,str}=o;
  return(<div style={{background:"#fff",borderRadius:12,border:"1px solid var(--s200)",padding:"16px 20px",marginBottom:10}}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:10,marginBottom:12}}>
      <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}>
        <Av i={mkI(s.n)} sz={36} on pan={s.ty==="pan"}/><div><PLink p={s}/><div style={{fontSize:10,color:"var(--s400)"}}>{s.t}{s.ty==="pan"&&<span style={{marginLeft:5,fontSize:9,background:"#f5f3ff",color:"var(--vio)",padding:"1px 5px",borderRadius:6,fontWeight:700}}>PAN</span>}</div></div>
        <span style={{color:"var(--s300)",fontSize:16}}>{"\u2194"}</span>
        <Av i={mkI(t.name)} sz={36}/><div><PLink p={t}/><div style={{fontSize:10,color:"var(--s400)"}}>{t.title}</div></div>
      </div>
      <div style={{display:"flex",alignItems:"center",gap:8}}><Rng sc={sc}/><Bdg s={str}/></div>
    </div>
    <div style={{display:"flex",flexDirection:"column",gap:6}}>
      {sig.map((s,i)=>(<div key={i} style={{display:"flex",gap:10,padding:"8px 12px",background:"var(--s50)",borderRadius:8,borderLeft:"3px solid "+(TCOL[s.type]||"var(--s200)")}}>
        <span style={{fontSize:14,flexShrink:0}}>{s.icon}</span>
        <div style={{flex:1}}>
          <div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}><span style={{fontSize:10,fontWeight:700,color:TCOL[s.type],textTransform:"uppercase",letterSpacing:".3px"}}>{s.type}</span><span style={{fontSize:10,fontWeight:700,color:"var(--s400)"}}>+{s.pts}</span></div>
          <div style={{fontSize:12,fontWeight:600,marginBottom:1}}>{s.label}</div>
          <div style={{fontSize:11,color:"var(--s500)",lineHeight:1.5}}>{s.detail}</div>
        </div>
      </div>))}
    </div>
  </div>);
}

function OList({overlaps,groupBy,filter}){
  const fil=overlaps.filter(o=>filter==="all"||o.str===filter);
  if(!fil.length)return<div style={{background:"#fff",borderRadius:16,border:"1px solid var(--s200)",padding:"40px",textAlign:"center"}}><div style={{fontSize:32,marginBottom:8}}>{"\u{1F50D}"}</div><div style={{fontSize:14,fontWeight:600,color:"var(--s500)"}}>No overlaps at this level</div></div>;
  const gr={};
  for(const o of fil){const k=groupBy==="sp"?o.sp.id:o.tgt.id;if(!gr[k])gr[k]={h:groupBy==="sp"?o.sp:o.tgt,items:[],isSP:groupBy==="sp"};gr[k].items.push(o);}
  return(<div style={{display:"flex",flexDirection:"column",gap:18}}>
    {Object.values(gr).map(({h,items,isSP})=>(<div key={h.id||h.name}>
      <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10,padding:"0 2px"}}>
        <Av i={mkI(isSP?h.n:h.name)} sz={34} on={isSP} pan={h.ty==="pan"}/><div><div style={{fontSize:13,fontWeight:700}}>{isSP?h.n:h.name}</div><div style={{fontSize:10,color:"var(--s400)"}}>{isSP?h.t:h.title} {"\u00b7"} {items.length} overlap{items.length!==1?"s":""}</div></div>
        {!isSP&&<div style={{marginLeft:"auto"}}><Bdg s={items[0].str}/></div>}
      </div>
      {items.map((o,i)=><OCard key={i} o={o}/>)}
    </div>))}
  </div>);
}

/* ═══ PERSON EDITOR ═══ */
function PEditor({person:p,onChange,onRemove,companyName}){
  const[open,setOpen]=useState(!p.name);
  const[customOrg,setCustomOrg]=useState("");
  const toggle=(list,item)=>list.map(x=>x.toLowerCase()).includes(item.toLowerCase())?list.filter(x=>x.toLowerCase()!==item.toLowerCase()):[...list,item];
  return(<div style={{background:"#fff",borderRadius:10,border:"1px solid var(--s200)",marginBottom:6,overflow:"hidden"}}>
    <div style={{display:"flex",alignItems:"center",gap:8,padding:"10px 14px",cursor:"pointer"}} onClick={()=>setOpen(!open)}>
      <Av i={mkI(p.name||"?")} sz={28}/><div style={{flex:1,minWidth:0}}><div style={{fontSize:12,fontWeight:700,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{p.name||"New Person"}</div><div style={{fontSize:10,color:"var(--s400)"}}>{p.title||"Add details"}{p.orgs.length>0?" \u00b7 "+p.orgs.length+" co":""}</div></div>
      {p.orgs.length>0&&<span style={{fontSize:10,fontWeight:700,color:"var(--grn)",background:"rgba(34,197,94,.08)",padding:"2px 6px",borderRadius:4}}>{p.orgs.length} co</span>}
      <span style={{fontSize:10,color:"var(--s400)",transform:open?"rotate(180deg)":"none",transition:".15s"}}>{"\u25bc"}</span>
    </div>
    {open&&(<div style={{padding:"0 14px 14px",borderTop:"1px solid var(--s100)"}}>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginTop:10,marginBottom:12}}>
        <div><label style={{fontSize:9,fontWeight:700,color:"var(--s400)",textTransform:"uppercase",letterSpacing:".5px",marginBottom:3,display:"block"}}>Name</label>
          <input value={p.name} onChange={e=>onChange({...p,name:e.target.value})} placeholder="Full name" style={{width:"100%",height:34,border:"1.5px solid var(--s200)",borderRadius:7,padding:"0 10px",fontSize:12,outline:"none"}}/></div>
        <div><label style={{fontSize:9,fontWeight:700,color:"var(--s400)",textTransform:"uppercase",letterSpacing:".5px",marginBottom:3,display:"block"}}>Title</label>
          <input value={p.title} onChange={e=>onChange({...p,title:e.target.value})} placeholder="CEO, Board Member..." style={{width:"100%",height:34,border:"1.5px solid var(--s200)",borderRadius:7,padding:"0 10px",fontSize:12,outline:"none"}}/></div>
      </div>
      <label style={{fontSize:9,fontWeight:700,color:"var(--s400)",textTransform:"uppercase",letterSpacing:".5px",marginBottom:5,display:"block"}}>Companies <span style={{fontWeight:500,textTransform:"none"}}>(click SP-relevant companies)</span></label>
      <div style={{display:"flex",flexWrap:"wrap",gap:3,marginBottom:6}}>
        {SP_ORGS.map(org=>(<button key={org} className={"chip"+(p.orgs.some(o=>oE(o,org))?" on":"")} style={{padding:"3px 8px",fontSize:10,borderRadius:5}} onClick={()=>onChange({...p,orgs:toggle(p.orgs,org)})}>{org}</button>))}
      </div>
      <div style={{display:"flex",gap:4,marginBottom:12}}>
        <input value={customOrg} onChange={e=>setCustomOrg(e.target.value)} onKeyDown={e=>{if(e.key==="Enter"&&customOrg.trim()){onChange({...p,orgs:[...p.orgs,customOrg.trim()]});setCustomOrg("");}}} placeholder="+ Other company" style={{flex:1,height:30,border:"1.5px solid var(--s200)",borderRadius:7,padding:"0 8px",fontSize:11,outline:"none"}}/>
        <button onClick={()=>{if(customOrg.trim()){onChange({...p,orgs:[...p.orgs,customOrg.trim()]});setCustomOrg("");}}} style={{height:30,padding:"0 10px",borderRadius:7,border:"none",background:"var(--s900)",color:"#fff",fontSize:10,fontWeight:700}}>Add</button>
      </div>
      <label style={{fontSize:9,fontWeight:700,color:"var(--s400)",textTransform:"uppercase",letterSpacing:".5px",marginBottom:5,display:"block"}}>Education</label>
      <div style={{display:"flex",flexWrap:"wrap",gap:3,marginBottom:12}}>
        {SP_SCHOOLS.map(sch=>(<button key={sch} className={"chip"+(p.education.some(e=>sN(e.s)===sN(sch))?" on":"")} style={{padding:"3px 8px",fontSize:10,borderRadius:5}} onClick={()=>{const has=p.education.some(e=>sN(e.s)===sN(sch));onChange({...p,education:has?p.education.filter(e=>sN(e.s)!==sN(sch)):[...p.education,{s:sch,y:null}]});}}>{sch}</button>))}
      </div>
      <div style={{display:"flex",gap:4}}>
        <input value={p.location} onChange={e=>onChange({...p,location:e.target.value})} placeholder="City, State" style={{flex:1,height:30,border:"1.5px solid var(--s200)",borderRadius:7,padding:"0 8px",fontSize:11,outline:"none"}}/>
        <button onClick={onRemove} style={{height:30,padding:"0 10px",borderRadius:7,border:"1.5px solid var(--rose)",background:"#fff",color:"var(--rose)",fontSize:10,fontWeight:700}}>Remove</button>
      </div>
    </div>)}
  </div>);
}

/* ═══ MAIN APP ═══ */
function App(){
  const[url,setUrl]=useState("");
  const[phase,setPhase]=useState("search"); // search | loading | editing | results
  const[people,setPeople]=useState([]);
  const[overlaps,setOverlaps]=useState([]);
  const[companyName,setCompanyName]=useState("");
  const[error,setError]=useState("");
  const[loadStep,setLoadStep]=useState(0);
  const[groupBy,setGroupBy]=useState("sp");
  const[filter,setFilter]=useState("all");
  const[targetCount,setTargetCount]=useState(0);
  const[queriesUsed,setQueriesUsed]=useState(0);
  const[pasteMode,setPasteMode]=useState(false);
  const[pasteText,setPasteText]=useState("");
  const ref=useRef(null);

  async function handleSearch(){
    if(!url.trim())return;
    const m=url.match(/linkedin\.com\/company\/([^/?#\s]+)/);
    if(!m){setError("Paste a LinkedIn company URL (linkedin.com/company/...)");return;}
    setError("");setPhase("loading");setLoadStep(0);

    try{
      // Check backend is running
      try{await fetch(API+"/api/health");}catch{
        setError("Backend not running. Open a terminal and run:\n\ncd smith-point-rcp && pip install -r requirements.txt && python backend/server.py");
        setPhase("search");return;
      }

      setLoadStep(1);
      const r=await fetch(API+"/api/find-connections",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({url:url.trim()}),
      });

      if(!r.ok){const e=await r.text();throw new Error(e);}
      const data=await r.json();

      setCompanyName(data.company_name);
      setQueriesUsed(data.search_queries_used||0);

      // Normalize people from backend
      const norm=data.people.map(p=>({
        ...p,
        education:(p.education||[]).map(e=>typeof e==="string"?{s:e,y:null}:e),
        orgs:p.orgs||[],board:p.board||[],
      }));

      setPeople(norm);
      setLoadStep(2);

      if(norm.length===0){
        setPhase("editing");
        setError("No leadership found automatically. Add people manually below.");
      }else{
        // Auto-analyze
        setTargetCount(norm.length);
        const ov=scoreAll(norm);
        setOverlaps(ov);
        setPhase("results");
        setTimeout(()=>ref.current?.scrollIntoView({behavior:"smooth"}),200);
      }
    }catch(err){
      console.error(err);
      setError("Error: "+err.message);
      setPhase("search");
    }
  }

  function addPerson(){setPeople(p=>[...p,{id:"m-"+Math.random().toString(36).slice(2,8),name:"",title:"",orgs:[companyName].filter(Boolean),education:[],board:[],location:"",linkedin:""}]);}
  function updatePerson(i,u){setPeople(p=>p.map((x,j)=>j===i?u:x));}
  function removePerson(i){setPeople(p=>p.filter((_,j)=>j!==i));}

  function reAnalyze(){
    const valid=people.filter(p=>p.name.trim());
    if(!valid.length){setError("Add at least one person.");return;}
    setTargetCount(valid.length);
    setOverlaps(scoreAll(valid));setPhase("results");setFilter("all");
    setTimeout(()=>ref.current?.scrollIntoView({behavior:"smooth"}),200);
  }

  function reset(){setPhase("search");setPeople([]);setOverlaps([]);setError("");setUrl("");setCompanyName("");}

  function doPaste(){
    const lines=pasteText.split("\n").map(l=>l.trim()).filter(Boolean);
    const parsed=lines.map(l=>{
      const pts=l.split(/\s*[-\u2013\u2014,|]\s*/);
      return{id:"m-"+Math.random().toString(36).slice(2,8),name:pts[0]||"",title:pts.slice(1).join(", ")||"",orgs:[companyName].filter(Boolean),education:[],board:[],location:"",linkedin:""};
    }).filter(p=>p.name);
    if(parsed.length){setPeople(p=>[...p,...parsed]);setPasteText("");setPasteMode(false);}
  }

  const strongN=overlaps.filter(o=>o.str==="strong").length;
  const medN=overlaps.filter(o=>o.str==="medium").length;
  const weakN=overlaps.filter(o=>o.str==="weak").length;
  const total=overlaps.length;
  const uniqueSP=[...new Set(overlaps.map(o=>o.sp.n))].length;
  const Tb=({on,onClick,children})=>(<button onClick={onClick} style={{padding:"5px 12px",borderRadius:7,fontSize:11,fontWeight:600,border:"1.5px solid",background:on?"var(--s900)":"#fff",color:on?"#fff":"var(--s500)",borderColor:on?"var(--s900)":"var(--s200)"}}>{children}</button>);

  return(<>
    <div style={{background:"#fff",borderBottom:"1px solid var(--s200)",padding:"0 20px"}}><div style={{maxWidth:1060,margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between",height:56}}>
      <div style={{display:"flex",alignItems:"center",gap:10}}><div style={{width:30,height:30,borderRadius:7,background:"var(--s900)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:800,color:"#fff"}}>SP</div><div><div style={{fontSize:14,fontWeight:800,letterSpacing:"-.3px"}}>Smith Point Capital</div><div style={{fontSize:9,color:"var(--s400)",fontWeight:600,letterSpacing:".5px",textTransform:"uppercase"}}>Connection Finder</div></div></div>
      <div style={{display:"flex",alignItems:"center",gap:10}}><span style={{fontSize:10,color:"var(--s400)",fontWeight:600}}>{SP.filter(m=>m.ty==="core").length} core {"\u00b7"} {SP.filter(m=>m.ty==="pan").length} advisors</span>{phase!=="search"&&phase!=="loading"&&<button onClick={reset} style={{padding:"4px 10px",borderRadius:6,border:"1.5px solid var(--s200)",background:"#fff",fontSize:10,fontWeight:700,color:"var(--s500)"}}>{"\u2190"} New</button>}</div>
    </div></div>

    <div style={{maxWidth:1060,margin:"0 auto",padding:"24px 20px 80px"}}>

      {/* SEARCH */}
      {phase==="search"&&(<div style={{animation:"fadeUp .3s ease"}}>
        <div style={{background:"#fff",borderRadius:16,border:"1px solid var(--s200)",padding:"28px",marginBottom:20}}>
          <div style={{fontSize:18,fontWeight:800,marginBottom:4}}>Find Connections</div>
          <div style={{fontSize:12,color:"var(--s500)",marginBottom:18,lineHeight:1.6}}>Paste a company's LinkedIn URL. The backend scrapes DuckDuckGo for their leadership team's career histories from public LinkedIn data, then checks every combination against all {SP.length} SP team members and advisors.</div>
          <div style={{display:"flex",gap:8}}>
            <input value={url} onChange={e=>{setUrl(e.target.value);setError("");}} onKeyDown={e=>e.key==="Enter"&&handleSearch()} placeholder="https://www.linkedin.com/company/salientai/" style={{flex:1,height:48,border:"1.5px solid var(--s200)",borderRadius:10,padding:"0 16px",fontSize:14,fontFamily:"var(--m)",outline:"none"}} onFocus={e=>e.target.style.borderColor="var(--blu)"} onBlur={e=>e.target.style.borderColor="var(--s200)"}/>
            <button onClick={handleSearch} disabled={!url.trim()} style={{height:48,padding:"0 24px",borderRadius:10,border:"none",background:"var(--s900)",color:"#fff",fontSize:13,fontWeight:700,whiteSpace:"nowrap",opacity:url.trim()?1:0.5}}>Find Connections {"\u2192"}</button>
          </div>
          {error&&<div style={{marginTop:10,padding:"10px 14px",background:"#fff1f2",border:"1px solid #fecdd3",borderRadius:8,fontSize:12,color:"#be123c",lineHeight:1.5,whiteSpace:"pre-wrap"}}>{error}</div>}
          <div style={{marginTop:14,padding:"10px 14px",background:"var(--s50)",borderRadius:8,fontSize:11,color:"var(--s500)",lineHeight:1.5}}>
            <strong>Setup:</strong> Run the backend locally first:<br/>
            <code style={{fontFamily:"var(--m)",fontSize:11,background:"var(--s100)",padding:"1px 4px",borderRadius:3}}>pip install -r requirements.txt && python backend/server.py</code>
          </div>
        </div>
        <div style={{background:"#fff",borderRadius:16,border:"1px solid var(--s200)",padding:"40px",textAlign:"center"}}>
          <div style={{fontSize:40,marginBottom:12}}>{"\u{1F578}\ufe0f"}</div>
          <div style={{fontSize:15,fontWeight:700,marginBottom:6}}>Automated LinkedIn Connection Mapping</div>
          <div style={{fontSize:12,color:"var(--s500)",maxWidth:440,margin:"0 auto",lineHeight:1.6}}>Paste any company's LinkedIn URL. The system scrapes leadership profiles via DuckDuckGo, extracts career histories, and checks all possible connections against the entire Smith Point network. No API keys needed.</div>
          <div style={{marginTop:24,fontSize:10,fontWeight:700,color:"var(--s400)",letterSpacing:".5px",textTransform:"uppercase",marginBottom:10}}>Checked against {SP.length} people</div>
          <div style={{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:6}}>
            {SP.filter(m=>m.orgs.length||m.board.length||m.edu.length).map(m=>(<div key={m.id} style={{display:"flex",alignItems:"center",gap:4,padding:"3px 8px",background:m.ty==="pan"?"#f5f3ff":"var(--s50)",borderRadius:14,border:"1px solid "+(m.ty==="pan"?"#e9d5ff":"var(--s200)")}}><div style={{width:16,height:16,borderRadius:"50%",background:m.ty==="pan"?"var(--vio)":"var(--s900)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:6,fontWeight:800,color:"#fff"}}>{mkI(m.n)}</div><span style={{fontSize:10,fontWeight:600,color:"var(--s700)"}}>{m.n.split(" ")[0]}</span></div>))}
          </div>
        </div>
      </div>)}

      {/* LOADING */}
      {phase==="loading"&&(<div style={{animation:"fadeUp .3s ease"}}><div style={{background:"#fff",borderRadius:16,border:"1px solid var(--s200)",padding:"28px"}}>
        <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:20}}><div style={{width:20,height:20,border:"2.5px solid var(--blu)",borderTopColor:"transparent",borderRadius:"50%",animation:"spin .7s linear infinite"}}/><span style={{fontSize:14,fontWeight:700}}>Searching for {companyName || "company"} leadership...</span></div>
        {["Scraping DuckDuckGo for LinkedIn profiles\u2026","Extracting career histories & education\u2026","Scoring all combinations\u2026"].map((label,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 0",opacity:i<=loadStep?1:.3,transition:"opacity .4s"}}><div style={{width:22,height:22,borderRadius:"50%",background:i<loadStep?"var(--grn)":i===loadStep?"var(--blu)":"var(--s200)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,color:"#fff",fontWeight:700}}>{i<loadStep?"\u2713":i+1}</div><span style={{fontSize:12,color:i===loadStep?"var(--s900)":"var(--s400)",fontWeight:i===loadStep?700:400,animation:i===loadStep?"pulse 2s infinite":"none"}}>{label}</span></div>))}
        <div style={{marginTop:16,padding:"10px 14px",background:"var(--s50)",borderRadius:8,fontSize:11,color:"var(--s500)"}}>Checking {SP.length} SP people. Takes 20-60 seconds depending on company size.</div>
      </div></div>)}

      {/* EDITING */}
      {phase==="editing"&&(<div style={{animation:"fadeUp .3s ease"}}>
        <div style={{background:"#fff",borderRadius:16,border:"1px solid var(--s200)",padding:"20px 24px",marginBottom:14}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8,marginBottom:8}}>
            <div><div style={{fontSize:16,fontWeight:800}}>{companyName} Leadership</div><div style={{fontSize:11,color:"var(--s500)"}}>{people.length} people {queriesUsed>0?"("+queriesUsed+" searches used)":""}</div></div>
            <div style={{display:"flex",gap:4}}><button onClick={()=>setPasteMode(!pasteMode)} className="chip">{pasteMode?"\u2715":"Paste List"}</button><button onClick={addPerson} className="chip">+ Add Person</button></div>
          </div>
          {error&&<div style={{padding:"8px 12px",background:"#fffbeb",border:"1px solid #fde68a",borderRadius:8,fontSize:12,color:"#92400e",marginBottom:10}}>{error}</div>}
          {pasteMode&&(<div style={{background:"var(--s50)",borderRadius:8,padding:"12px",marginBottom:10,border:"1px solid var(--s200)"}}>
            <div style={{fontSize:10,fontWeight:700,color:"var(--s500)",marginBottom:4}}>Paste names (one per line, "Name - Title"):</div>
            <textarea value={pasteText} onChange={e=>setPasteText(e.target.value)} placeholder={"Marc Benioff - CEO\nParker Harris - CTO"} rows={4} style={{width:"100%",border:"1.5px solid var(--s200)",borderRadius:7,padding:"8px 10px",fontSize:11,fontFamily:"var(--m)",resize:"vertical",outline:"none"}}/>
            <button onClick={doPaste} disabled={!pasteText.trim()} style={{marginTop:6,padding:"5px 14px",borderRadius:7,border:"none",background:"var(--s900)",color:"#fff",fontSize:11,fontWeight:700,opacity:pasteText.trim()?1:.5}}>Add people</button>
          </div>)}
          {people.map((p,i)=><PEditor key={p.id} person={p} onChange={u=>updatePerson(i,u)} onRemove={()=>removePerson(i)} companyName={companyName}/>)}
          {people.length===0&&!pasteMode&&<div style={{textAlign:"center",padding:"24px",color:"var(--s400)",fontSize:12}}>No people yet. Click "+ Add Person" or "Paste List".</div>}
        </div>
        {people.filter(p=>p.name.trim()).length>0&&(
          <button onClick={reAnalyze} style={{width:"100%",height:50,borderRadius:12,border:"none",background:"var(--s900)",color:"#fff",fontSize:15,fontWeight:800,letterSpacing:"-.2px"}}
            onMouseEnter={e=>e.target.style.background="var(--s800)"} onMouseLeave={e=>e.target.style.background="var(--s900)"}>
            Analyze All Connections ({people.filter(p=>p.name.trim()).length} {"\u00d7"} {SP.length} = {people.filter(p=>p.name.trim()).length*SP.length} combinations) {"\u2192"}
          </button>)}
      </div>)}

      {/* RESULTS */}
      {phase==="results"&&(<div ref={ref} style={{animation:"fadeUp .3s ease"}}>
        <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(115px,1fr))",gap:8,marginBottom:14}}>
          {[{l:"Total",v:total,c:"var(--s900)"},{l:"Strong",v:strongN,c:"var(--grn)"},{l:"Medium",v:medN,c:"var(--amb)"},{l:"Weak",v:weakN,c:"var(--s400)"},{l:"SP Matched",v:uniqueSP,c:"var(--blu)"},{l:"People Checked",v:targetCount,c:"var(--vio)"}].map((s,i)=>(
            <div key={i} style={{background:"#fff",borderRadius:12,border:"1px solid var(--s200)",padding:"14px",textAlign:"center"}}><div style={{fontSize:22,fontWeight:800,color:s.c}}>{s.v}</div><div style={{fontSize:9,fontWeight:700,color:"var(--s400)",textTransform:"uppercase",letterSpacing:".4px",marginTop:2}}>{s.l}</div></div>))}
        </div>
        <div style={{background:"#fff",borderRadius:12,border:"1px solid var(--s200)",padding:"14px 18px",marginBottom:14}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8,marginBottom:10}}>
            <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}>
              <span style={{fontSize:12,fontWeight:700,background:"var(--s100)",padding:"3px 10px",borderRadius:6}}>{total} connection{total!==1?"s":""} {"\u00b7"} {companyName}</span>
              <div style={{display:"flex",gap:4}}><Tb on={groupBy==="sp"} onClick={()=>setGroupBy("sp")}>By SP</Tb><Tb on={groupBy==="leader"} onClick={()=>setGroupBy("leader")}>By Leader</Tb></div>
            </div>
            <button onClick={()=>{setPhase("editing");setOverlaps([]);}} style={{padding:"5px 12px",borderRadius:7,border:"1.5px solid var(--s200)",background:"#fff",fontSize:11,fontWeight:600,color:"var(--s500)"}}>{"\u270e"} Edit People</button>
          </div>
          <div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}>
            <span style={{fontSize:9,fontWeight:700,color:"var(--s400)",letterSpacing:".5px",textTransform:"uppercase"}}>Filter</span>
            {[{k:"all",l:"All ("+total+")",ab:"var(--s900)",ib:"var(--s50)",ic:"var(--s500)"},
              {k:"strong",l:"Strong ("+strongN+")",ab:"var(--grn)",ib:"#f0fdf4",ic:"var(--grn)"},
              {k:"medium",l:"Medium ("+medN+")",ab:"var(--amb)",ib:"#fffbeb",ic:"var(--amb)"},
              {k:"weak",l:"Weak ("+weakN+")",ab:"var(--s400)",ib:"var(--s50)",ic:"var(--s400)"},
            ].map(c=>(<button key={c.k} className="chip" onClick={()=>setFilter(c.k)} style={{background:filter===c.k?c.ab:c.ib,color:filter===c.k?"#fff":c.ic,borderColor:filter===c.k?c.ab:"var(--s200)"}}>{c.l}</button>))}
          </div>
        </div>
        <OList overlaps={overlaps} groupBy={groupBy} filter={filter}/>
        {total===0&&<div style={{background:"#fff",borderRadius:16,border:"1px solid var(--s200)",padding:"40px",textAlign:"center"}}><div style={{fontSize:36,marginBottom:8}}>{"\u{1F52D}"}</div><div style={{fontSize:14,fontWeight:700}}>No connections found</div><div style={{fontSize:12,color:"var(--s500)",marginTop:4}}>Try editing people and adding more company history. Click "Edit People" above.</div></div>}
      </div>)}
    </div>
  </>);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
